{"ast":null,"code":"import React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport { matchRoutes } from \"react-router-config\";\nimport { withRouter } from \"react-router-dom\";\nimport Utils from \"app/helpers/utils\";\nimport AppContext from \"app/app_context\";\nimport { Fragment as _Fragment, jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nclass Authorization extends Component {\n  constructor(props, context) {\n    super(props);\n    const {\n      routes\n    } = context;\n    this.state = {\n      accessGranted: true,\n      routes\n    };\n  }\n  componentDidMount() {\n    if (!this.state.accessGranted) {\n      this.redirectRoute();\n    }\n  }\n  shouldComponentUpdate(nextProps, nextState) {\n    return nextState.accessGranted !== this.state.accessGranted;\n  }\n  componentDidUpdate() {\n    if (!this.state.accessGranted) {\n      this.redirectRoute();\n    }\n  }\n  static getDerivedStateFromProps(props, state) {\n    const {\n      location,\n      userRole\n    } = props;\n    const {\n      pathname\n    } = location;\n    const matched = matchRoutes(state.routes, pathname)[0];\n    return {\n      accessGranted: matched ? Utils.hasPermission(matched.route.auth, userRole) : true\n    };\n  }\n  redirectRoute() {\n    const {\n      location,\n      userRole,\n      history\n    } = this.props;\n    const {\n      pathname\n    } = location;\n    if (!userRole || userRole.length === 0) {\n      history.push({\n        pathname: \"/\",\n        state: {\n          redirectUrl: pathname\n        }\n      });\n    }\n  }\n  render() {\n    // return this.state.accessGranted ? <>{this.props.children}</> : null;\n    return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: this.props.children\n    }, void 0, false);\n  }\n}\nfunction mapStateToProps({\n  auth\n}) {\n  return {\n    userRole: auth.user.role\n  };\n}\nAuthorization.contextType = AppContext;\nexport default withRouter(connect(mapStateToProps)(Authorization));","map":{"version":3,"names":["React","Component","connect","matchRoutes","withRouter","Utils","AppContext","Fragment","_Fragment","jsxDEV","_jsxDEV","Authorization","constructor","props","context","routes","state","accessGranted","componentDidMount","redirectRoute","shouldComponentUpdate","nextProps","nextState","componentDidUpdate","getDerivedStateFromProps","location","userRole","pathname","matched","hasPermission","route","auth","history","length","push","redirectUrl","render","children","mapStateToProps","user","role","contextType"],"sources":["D:/project-individual/reactjs/tool-hai-van-frontend/src/app/auth/authorization.js"],"sourcesContent":["import React, { Component } from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport { matchRoutes } from \"react-router-config\";\r\nimport { withRouter } from \"react-router-dom\";\r\n\r\nimport Utils from \"app/helpers/utils\";\r\nimport AppContext from \"app/app_context\";\r\n\r\nclass Authorization extends Component {\r\n  constructor(props, context) {\r\n    super(props);\r\n    const { routes } = context;\r\n    this.state = {\r\n      accessGranted: true,\r\n      routes,\r\n    };\r\n  }\r\n\r\n  componentDidMount() {\r\n    if (!this.state.accessGranted) {\r\n      this.redirectRoute();\r\n    }\r\n  }\r\n\r\n  shouldComponentUpdate(nextProps, nextState) {\r\n    return nextState.accessGranted !== this.state.accessGranted;\r\n  }\r\n\r\n  componentDidUpdate() {\r\n    if (!this.state.accessGranted) {\r\n      this.redirectRoute();\r\n    }\r\n  }\r\n\r\n  static getDerivedStateFromProps(props, state) {\r\n    const { location, userRole } = props;\r\n    const { pathname } = location;\r\n\r\n    const matched = matchRoutes(state.routes, pathname)[0];\r\n\r\n    return {\r\n      accessGranted: matched\r\n        ? Utils.hasPermission(matched.route.auth, userRole)\r\n        : true,\r\n    };\r\n  }\r\n\r\n  redirectRoute() {\r\n    const { location, userRole, history } = this.props;\r\n    const { pathname } = location;\r\n    if (!userRole || userRole.length === 0) {\r\n      history.push({\r\n        pathname: \"/\",\r\n        state: { redirectUrl: pathname },\r\n      });\r\n    }\r\n  }\r\n\r\n  render() {\r\n    // return this.state.accessGranted ? <>{this.props.children}</> : null;\r\n    return <>{this.props.children}</>;\r\n  }\r\n}\r\n\r\nfunction mapStateToProps({ auth }) {\r\n  return {\r\n    userRole: auth.user.role,\r\n  };\r\n}\r\n\r\nAuthorization.contextType = AppContext;\r\n\r\nexport default withRouter(connect(mapStateToProps)(Authorization));\r\n"],"mappings":"AAAA,OAAOA,KAAK,IAAIC,SAAS,QAAQ,OAAO;AACxC,SAASC,OAAO,QAAQ,aAAa;AACrC,SAASC,WAAW,QAAQ,qBAAqB;AACjD,SAASC,UAAU,QAAQ,kBAAkB;AAE7C,OAAOC,KAAK,MAAM,mBAAmB;AACrC,OAAOC,UAAU,MAAM,iBAAiB;AAAC,SAAAC,QAAA,IAAAC,SAAA,EAAAC,MAAA,IAAAC,OAAA;AAEzC,MAAMC,aAAa,SAASV,SAAS,CAAC;EACpCW,WAAWA,CAACC,KAAK,EAAEC,OAAO,EAAE;IAC1B,KAAK,CAACD,KAAK,CAAC;IACZ,MAAM;MAAEE;IAAO,CAAC,GAAGD,OAAO;IAC1B,IAAI,CAACE,KAAK,GAAG;MACXC,aAAa,EAAE,IAAI;MACnBF;IACF,CAAC;EACH;EAEAG,iBAAiBA,CAAA,EAAG;IAClB,IAAI,CAAC,IAAI,CAACF,KAAK,CAACC,aAAa,EAAE;MAC7B,IAAI,CAACE,aAAa,CAAC,CAAC;IACtB;EACF;EAEAC,qBAAqBA,CAACC,SAAS,EAAEC,SAAS,EAAE;IAC1C,OAAOA,SAAS,CAACL,aAAa,KAAK,IAAI,CAACD,KAAK,CAACC,aAAa;EAC7D;EAEAM,kBAAkBA,CAAA,EAAG;IACnB,IAAI,CAAC,IAAI,CAACP,KAAK,CAACC,aAAa,EAAE;MAC7B,IAAI,CAACE,aAAa,CAAC,CAAC;IACtB;EACF;EAEA,OAAOK,wBAAwBA,CAACX,KAAK,EAAEG,KAAK,EAAE;IAC5C,MAAM;MAAES,QAAQ;MAAEC;IAAS,CAAC,GAAGb,KAAK;IACpC,MAAM;MAAEc;IAAS,CAAC,GAAGF,QAAQ;IAE7B,MAAMG,OAAO,GAAGzB,WAAW,CAACa,KAAK,CAACD,MAAM,EAAEY,QAAQ,CAAC,CAAC,CAAC,CAAC;IAEtD,OAAO;MACLV,aAAa,EAAEW,OAAO,GAClBvB,KAAK,CAACwB,aAAa,CAACD,OAAO,CAACE,KAAK,CAACC,IAAI,EAAEL,QAAQ,CAAC,GACjD;IACN,CAAC;EACH;EAEAP,aAAaA,CAAA,EAAG;IACd,MAAM;MAAEM,QAAQ;MAAEC,QAAQ;MAAEM;IAAQ,CAAC,GAAG,IAAI,CAACnB,KAAK;IAClD,MAAM;MAAEc;IAAS,CAAC,GAAGF,QAAQ;IAC7B,IAAI,CAACC,QAAQ,IAAIA,QAAQ,CAACO,MAAM,KAAK,CAAC,EAAE;MACtCD,OAAO,CAACE,IAAI,CAAC;QACXP,QAAQ,EAAE,GAAG;QACbX,KAAK,EAAE;UAAEmB,WAAW,EAAER;QAAS;MACjC,CAAC,CAAC;IACJ;EACF;EAEAS,MAAMA,CAAA,EAAG;IACP;IACA,oBAAO1B,OAAA,CAAAF,SAAA;MAAA6B,QAAA,EAAG,IAAI,CAACxB,KAAK,CAACwB;IAAQ,gBAAG,CAAC;EACnC;AACF;AAEA,SAASC,eAAeA,CAAC;EAAEP;AAAK,CAAC,EAAE;EACjC,OAAO;IACLL,QAAQ,EAAEK,IAAI,CAACQ,IAAI,CAACC;EACtB,CAAC;AACH;AAEA7B,aAAa,CAAC8B,WAAW,GAAGnC,UAAU;AAEtC,eAAeF,UAAU,CAACF,OAAO,CAACoC,eAAe,CAAC,CAAC3B,aAAa,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module"}